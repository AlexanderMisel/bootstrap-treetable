/**
 * bootstrap-treetable
 * v1.0.6-beta
 * @author swifly
 * @url https://gitee.com/cyf783/bootstrap-treetable/
 */
 !function(a){var b=function(b,c){this.options=c,this.$el=a(b),this.$el_=this.$el.clone(),this.hasSelectItem=!1,this.data_list=null,this.data_obj=null,this.hiddenColumns=[],this.lastAjaxParams,this.isFixWidth=!1,this.init()};b.prototype.init=function(){this.initContainer(),this.initToolbar(),this.initHeader(),this.initBody(),this.initServer(),this.autoTheadWidth(!0)},b.prototype.initContainer=function(){var b=this,c=a("<div class='bootstrap-tree-table'></div>"),d=a("<div class='treetable-table'></div>");b.$el.before(c),c.append(d),d.append(b.$el),b.$el.addClass("table"),b.options.striped&&b.$el.addClass("table-striped"),b.options.bordered&&b.$el.addClass("table-bordered"),b.options.hover&&b.$el.addClass("table-hover"),b.options.condensed&&b.$el.addClass("table-condensed"),b.$el.html("")},b.prototype.initToolbar=function(){var b,c,d,e,f=this,g=a("<div class='treetable-bars'></div>");f.options.toolbar&&(a(f.options.toolbar).addClass("tool-left"),g.append(a(f.options.toolbar))),b=a('<div class="btn-group tool-right">'),g.append(b),f.$el.parent().before(g),f.options.showRefresh&&(c=a('<button class="btn btn-default btn-outline" type="button" aria-label="refresh" title="刷新"><i class="glyphicon glyphicon-repeat"></i></button>'),b.append(c),f.registerRefreshBtnClickEvent(c)),f.options.showColumns?(d=a('<div class="btn-group pull-right" title="列"><button type="button" aria-label="columns" class="btn btn-default btn-outline dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="glyphicon glyphicon-list"></i> <span class="caret"></span></button></div>'),e=a('<ul class="dropdown-menu columns" role="menu"></ul>'),a.each(f.options.columns,function(b,c){if("selectItem"!=c.field){var d=null;"undefined"==typeof c.visible||1==c.visible?d=a('<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="'+c.field+'" value="'+c.field+'" > '+c.title+"</label></li>"):(d=a('<li role="menuitem"><label><input type="checkbox" data-field="'+c.field+'" value="'+c.field+'" > '+c.title+"</label></li>"),f.hiddenColumns.push(c.field)),e.append(d)}}),d.append(e),b.append(d),f.registerColumnClickEvent()):a.each(f.options.columns,function(a,b){"selectItem"!=b.field&&"undefined"!=typeof b.visible&&1!=b.visible&&f.hiddenColumns.push(b.field)})},b.prototype.initHiddenColumns=function(){var b=this;a.each(b.hiddenColumns,function(a,c){b.$el.find("."+c+"_cls").hide()})},b.prototype.initHeader=function(){var b,c=this,d=a("<tr></tr>");a.each(c.options.columns,function(b,e){var f=null;0==b&&"selectItem"==e.field?(c.hasSelectItem=!0,f=a('<th style="width:36px"></th>')):f=a('<th style="'+(e.width?"width:"+e.width:"")+'" class="'+e.field+'_cls"></th>'),!c.isFixWidth&&e.width&&(c.isFixWidth=e.width.indexOf("px")>-1?!0:!1),f.text(e.title),d.append(f)}),b=a('<thead class="treetable-thead"></thead>'),b.append(d),c.$el.append(b)},b.prototype.initBody=function(){var b=this,c=a('<tbody class="treetable-tbody"></tbody>');b.$el.append(c),b.options.height&&c.css("height",b.options.height)},b.prototype.initServer=function(b){var c,d,e=this;e.data_list={},e.data_obj={},c=e.$el.find("tbody"),d='<tr><td colspan="'+e.options.columns.length+'"><div style="display: block;text-align: center;">正在努力地加载数据中，请稍候……</div></td></tr>',c.html(d),e.options.url?a.ajax({type:e.options.type,url:e.options.url,data:b?b:e.options.ajaxParams,dataType:"JSON",success:function(a){e.renderTable(a),e.trigger("load-success",a)},error:function(a,b){var d='<tr><td colspan="'+e.options.columns.length+'"><div style="display: block;text-align: center;">'+xhr.responseText+"</div></td></tr>";c.html(d),e.trigger("load-error",b,a)}}):e.options.data?(e.renderTable(e.options.data),e.trigger("load-success",e.options.data)):e.trigger("load-error")},b.prototype.renderTable=function(b){var c,d,e=this,f=e.$el.find("tbody");return f.html(""),!b||b.length<=0?(c='<tr><td colspan="'+e.options.columns.length+'"><div style="display: block;text-align: center;">没有找到匹配的记录</div></td></tr>',f.html(c),void 0):(e.formatData(b),d=e.data_list._root_,d&&a.each(d,function(a,b){var c="row_id_"+a;e.recursionNode(b,1,c,"row_root")}),a.each(b,function(a,b){if(!b.isShow){var c=renderRow(b,!1,1,"","");f.append(c)}}),e.$el.append(f),e.registerExpanderEvent(),e.registerRowClickEvent(),e.initHiddenColumns(),e.autoTheadWidth(),void 0)},b.prototype.autoTheadWidth=function(b){var c,d,e,f,g=this;g.options.height>0&&(c=g.$el.find("thead"),d=g.$el.find("tbody"),e=parseInt(g.$el.css("border-left-width"))+parseInt(g.$el.css("border-right-width")),c.css("width",d.children(":first").width()),b&&(f=!1,a(window).resize(function(){f||(f=!0,setTimeout(function(){g.isFixWidth||d.css("width",g.$el.parent().width()-e),c.css("width",d.children(":first").width()),f=!1},300))})))},b.prototype.formatData=function(b){var c=this,d=c.options.rootIdValue?c.options.rootIdValue:null;a.each(b,function(a,b){b.isShow=!1;var e="0"==b[c.options.parentId]||0==b[c.options.parentId]||null==b[c.options.parentId]||""==b[c.options.parentId];!b[c.options.parentId]||(d?b[c.options.parentId]==c.options.rootIdValue:e)?(c.data_list._root_||(c.data_list._root_=[]),c.data_obj["id_"+b[c.options.id]]||c.data_list._root_.push(b)):(c.data_list["_n_"+b[c.options.parentId]]||(c.data_list["_n_"+b[c.options.parentId]]=[]),c.data_obj["id_"+b[c.options.id]]||c.data_list["_n_"+b[c.options.parentId]].push(b)),c.data_obj["id_"+b[c.options.id]]=b})},b.prototype.recursionNode=function(b,c,d,e){var f=this,g=f.$el.find("tbody"),h=f.data_list["_n_"+b[f.options.id]],i=f.renderRow(b,h?!0:!1,c,d,e);g.append(i),h&&a.each(h,function(a,b){var e=d+"_"+a;f.recursionNode(b,c+1,e,d)})},b.prototype.renderRow=function(b,c,d,e,f){var g,h,i=this;return b.isShow=!0,b.row_id=e,b.p_id=f,b.lv=d,g=a('<tr id="'+e+'" pid="'+f+'"></tr>'),h=i.options.expanderCollapsedClass,i.options.expandAll?(g.css("display","table"),h=i.options.expanderExpandedClass):1==d?(g.css("display","table"),h=i.options.expandFirst?i.options.expanderExpandedClass:i.options.expanderCollapsedClass):2==d?(i.options.expandFirst?g.css("display","table"):g.css("display","none"),h=i.options.expanderCollapsedClass):(g.css("display","none"),h=i.options.expanderCollapsedClass),a.each(i.options.columns,function(e,f){var j,k,l;if("selectItem"==f.field)i.hasSelectItem=!0,j=a('<td style="text-align:center;width:36px"></td>'),f.radio&&(k=a('<input name="select_item" type="radio" value="'+b[i.options.id]+'"></input>'),j.append(k)),f.checkbox&&(k=a('<input name="select_item" type="checkbox" value="'+b[i.options.id]+'"></input>'),j.append(k)),g.append(j);else{if(j=a('<td name="'+f.field+'" class="'+f.field+'_cls"></td>'),f.width&&j.css("width",f.width),f.align&&j.css("text-align",f.align),i.options.expandColumn==e&&j.css("text-align","left"),f.valign&&j.css("vertical-align",f.valign),i.options.showTitle&&j.addClass("ellipsis"),f.formatter?j.html(f.formatter.call(i,b[f.field],b,e)):(i.options.showTitle&&j.attr("title",b[f.field]),j.text(b[f.field])),i.options.expandColumn==e)for(c?j.prepend('<span class="treetable-expander '+h+'"></span>'):j.prepend('<span class="treetable-expander"></span>'),l=0;d-1>l;l++)j.prepend('<span class="treetable-indent"></span>');g.append(j)}}),g},b.prototype.registerRefreshBtnClickEvent=function(b){var c=this;a(b).off("click").on("click",function(){c.refresh()})},b.prototype.registerColumnClickEvent=function(){var b=this;a(".bootstrap-tree-table .treetable-bars .columns label input").off("click").on("click",function(){var c=a(this);c.prop("checked")?b.showColumn(a(this).val()):b.hideColumn(a(this).val())})},b.prototype.registerRowClickEvent=function(){var b=this;b.$el.find("tbody").find("tr").find("td").off("click dblclick").on("click dblclick",function(c){var d=a(this),e=d.parent(),f=e.find("input[name='select_item']"),g=b.data_obj["id_"+f.val()],h=d.attr("name"),i=g[h];b.trigger("click"===c.type?"click-cell":"dbl-click-cell",h,i,g,d),b.trigger("click"===c.type?"click-row":"dbl-click-row",g,e,h),b.hasSelectItem&&("radio"==f.attr("type")?(f.prop("checked",!0),b.$el.find("tbody").find("tr").removeClass("treetable-selected"),e.addClass("treetable-selected")):f.prop("checked")?(f.prop("checked",!1),e.removeClass("treetable-selected")):(f.prop("checked",!0),e.addClass("treetable-selected")))})},b.prototype.registerExpanderEvent=function(){var b=this;b.$el.find("tbody").find("tr").find(".treetable-expander").off("click").on("click",function(){var c,d,e,f=a(this).hasClass(b.options.expanderExpandedClass),g=a(this).hasClass(b.options.expanderCollapsedClass);(f||g)&&(c=a(this).parent().parent(),d=c.attr("id"),e=b.$el.find("tbody").find("tr[id^='"+d+"_']"),f?(a(this).removeClass(b.options.expanderExpandedClass),a(this).addClass(b.options.expanderCollapsedClass),e&&e.length>0&&a.each(e,function(b,c){a(c).css("display","none")})):(a(this).removeClass(b.options.expanderCollapsedClass),a(this).addClass(b.options.expanderExpandedClass),e&&e.length>0&&a.each(e,function(c,d){var e=a("#"+a(d).attr("pid")).children().eq(b.options.expandColumn).find(".treetable-expander");e.hasClass(b.options.expanderExpandedClass)&&a(d).css("display","table")})))})},b.prototype.refresh=function(a){var b=this;a&&(b.lastAjaxParams=a),b.initServer(b.lastAjaxParams)},b.prototype.appendData=function(b){var c=this;a.each(b,function(b,d){var e,f,g,h,i,j,k,l,m=c.data_obj["id_"+d[c.options.id]],n=c.data_obj["id_"+d[c.options.parentId]],o=c.data_list["_n_"+d[c.options.parentId]],p="",q="",r=1;m&&m.row_id&&""!=m.row_id&&(p=m.row_id),n?(q=n.row_id,""==p&&(f=0,o&&o.length>0&&(f=o.length),p=n.row_id+"_"+f),r=n.lv+1,e=c.renderRow(d,!1,r,p,q),g=a("#"+n.row_id).children().eq(c.options.expandColumn).find(".treetable-expander"),h=g.hasClass(c.options.expanderExpandedClass),i=g.hasClass(c.options.expanderCollapsedClass),h||i?h&&e.css("display","table"):g.addClass(c.options.expanderCollapsedClass),m?(a("#"+m.row_id).before(e),a("#"+m.row_id).remove()):(j=n.row_id.split("_"),k=n.row_id.substring(0,n.row_id.length-1)+(parseInt(j[j.length-1])+1),a("#"+k).before(e))):(e=c.renderRow(d,!1,r,p,q),m?(a("#"+m.row_id).before(e),a("#"+m.row_id).remove()):(l=c.$el.find("tbody"),l.append(e))),d.isShow=!0,c.formatData([d])}),c.registerExpanderEvent(),c.registerRowClickEvent(),c.initHiddenColumns()},b.prototype.toggleRow=function(b){var c=this,d=c.data_obj["id_"+b],e=a("#"+d.row_id).find(".treetable-expander");e.trigger("click")},b.prototype.expandRow=function(b){var c=this,d=c.data_obj["id_"+b],e=a("#"+d.row_id).find(".treetable-expander"),f=e.hasClass(c.$el.options.expanderCollapsedClass);f&&e.trigger("click")},b.prototype.collapseRow=function(b){var c=this,d=c.data_obj["id_"+b],e=a("#"+d.row_id).find(".treetable-expander"),f=e.hasClass(c.$el.options.expanderExpandedClass);f&&e.trigger("click")},b.prototype.expandAll=function(){var b=this;b.$el.find("tbody").find("tr").find(".treetable-expander").each(function(c,d){var e=a(d).hasClass(b.options.expanderCollapsedClass);e&&a(d).trigger("click")})},b.prototype.collapseAll=function(){var b=this;b.$el.find("tbody").find("tr").find(".treetable-expander").each(function(c,d){var e=a(d).hasClass(b.options.expanderExpandedClass);e&&a(d).trigger("click")})},b.prototype.showColumn=function(b,c){var d,e=this,f=a.inArray(b,e.hiddenColumns);f>-1&&e.hiddenColumns.splice(f,1),e.$el.find("."+b+"_cls").show(),c&&e.options.showColumns&&(d=a(".bootstrap-tree-table .treetable-bars .columns label").find("input[value='"+b+"']"),d.prop("checked","checked"))},b.prototype.hideColumn=function(b){var c,d=this;d.hiddenColumns.push(b),d.$el.find("."+b+"_cls").hide(),d.options.showColumns&&(c=a(".bootstrap-tree-table .treetable-bars .columns label").find("input[value='"+b+"']"),c.prop("checked",""))},b.prototype.getSelections=function(){var b,c=this,d=c.$el.find("tbody").find("tr").find("input[name='select_item']:checked"),e=[];return"radio"==d.attr("type")?(b=c.data_obj["id_"+d.val()],e.push(b)):d.each(function(b,d){var f=c.data_obj["id_"+a(d).val()];e.push(f)}),e},b.prototype.trigger=function(c){var d=this,e=Array.prototype.slice.call(arguments,1);c+=".bs.tree.table",d.options[b.EVENTS[c]].apply(d.options,e),d.$el.trigger(a.Event(c),e),d.options.onAll(c,e),d.$el.trigger(a.Event("all.bs.tree.table"),[c,e])},b.prototype.destroy=function(){var b=this,c=b.$el.parent().parent();b.$el.insertBefore(c),a(b.options.toolbar).insertBefore(b.$el),c.remove(),this.$el.html(this.$el_.html())},b.METHODS=["getSelections","refresh","appendData","toggleRow","expandRow","collapseRow","expandAll","collapseAll","showColumn","hideColumn","destroy"],b.EVENTS={"all.bs.tree.table":"onAll","click-cell.bs.tree.table":"onClickCell","dbl-click-cell.bs.tree.table":"onDblClickCell","click-row.bs.tree.table":"onClickRow","dbl-click-row.bs.tree.table":"onDblClickRow","load-success.bs.tree.table":"onLoadSuccess","load-error.bs.tree.table":"onLoadError"},b.DEFAULTS={id:"id",parentId:"parentId",rootIdValue:null,data:null,type:"GET",url:null,ajaxParams:{},expandColumn:0,expandAll:!1,expandFirst:!0,striped:!1,bordered:!0,hover:!0,condensed:!1,columns:[],toolbar:null,height:0,showTitle:!0,showColumns:!0,showRefresh:!0,expanderExpandedClass:"glyphicon glyphicon-chevron-down",expanderCollapsedClass:"glyphicon glyphicon-chevron-right",onAll:function(){return!1},onLoadSuccess:function(){return!1},onLoadError:function(){return!1},onClickCell:function(){return!1},onDblClickCell:function(){return!1},onClickRow:function(){return!1},onDblClickRow:function(){return!1}},a.fn.bootstrapTreeTable=function(c){var d,e=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=a(this),g=f.data("bootstrap.tree.table"),h=a.extend({},b.DEFAULTS,f.data(),"object"==typeof c&&c);if("string"==typeof c){if(a.inArray(c,b.METHODS)<0)throw new Error("Unknown method: "+c);if(!g)return;d=g[c].apply(g,e),"destroy"===c&&f.removeData("bootstrap.tree.table")}g||f.data("bootstrap.tree.table",g=new b(this,h))}),"undefined"==typeof d?this:d}}(jQuery);