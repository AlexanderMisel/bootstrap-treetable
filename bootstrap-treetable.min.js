!function(a){a.fn.bootstrapTreeTable=function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a(this).data("bootstrap.tree.table");return n=n?n:a(this),"string"==typeof b?a.fn.bootstrapTreeTable.methods[b](n,c):(b=a.extend({},a.fn.bootstrapTreeTable.defaults,b||{}),d=!1,n.data_list=null,n.data_obj=null,e=a("<div class='bootstrap-tree-table'></div>"),n.before(e),b.toolbar&&(f=a("<div class='treetable-bars pull-left'></div>"),f.append(a(b.toolbar)),e.append(f)),e.append(n),n.addClass("table table-hover treetable-table"),b.striped&&n.addClass("table-striped"),b.bordered&&n.addClass("table-bordered"),g=function(c){var d=b.rootIdValue?b.rootIdValue:null;a.each(c,function(a,c){c.isShow=!1;var e="0"==c[b.parentId]||0==c[b.parentId]||null==c[b.parentId]||""==c[b.parentId];!c[b.parentId]||(d?c[b.parentId]==b.rootIdValue:e)?(n.data_list._root_||(n.data_list._root_=[]),n.data_obj["id_"+c[b.id]]||n.data_list._root_.push(c)):(n.data_list["_n_"+c[b.parentId]]||(n.data_list["_n_"+c[b.parentId]]=[]),n.data_obj["id_"+c[b.id]]||n.data_list["_n_"+c[b.parentId]].push(c)),n.data_obj["id_"+c[b.id]]=c})},h=function(){return n.data_list._root_},i=function(c,d,e,f,g){var h=n.data_list["_n_"+c[b.id]],k=j(c,h?!0:!1,d,e,f);g.append(k),h&&a.each(h,function(a,b){var c=e+"_"+a;i(b,d+1,c,e,g)})},j=function(c,e,f,g,h){var i,j;return c.isShow=!0,c.row_id=g,c.p_id=h,c.lv=f,i=a('<tr id="'+g+'" pid="'+h+'"></tr>'),j=b.expanderCollapsedClass,b.expandAll?(i.css("display","table"),j=b.expanderExpandedClass):1==f?(i.css("display","table"),j=b.expandFirst?b.expanderExpandedClass:b.expanderCollapsedClass):2==f?(b.expandFirst?i.css("display","table"):i.css("display","none"),j=b.expanderCollapsedClass):(i.css("display","none"),j=b.expanderCollapsedClass),a.each(b.columns,function(g,h){var k,l,m;if("undefined"==typeof h.visible||1==h.visible)if("selectItem"==h.field)d=!0,k=a('<td style="text-align:center;width:36px"></td>'),h.radio&&(l=a('<input name="select_item" type="radio" value="'+c[b.id]+'"></input>'),k.append(l)),h.checkbox&&(l=a('<input name="select_item" type="checkbox" value="'+c[b.id]+'"></input>'),k.append(l)),i.append(k);else{if(k=a('<td title="'+c[h.field]+'" name="'+h.field+'"></td>'),h.width&&k.css("width",h.width),h.align&&k.css("text-align",h.align),h.width&&k.css("vertical-align",h.valign),h.formatter?k.html(h.formatter.call(this,c[h.field],c,g)):k.text(c[h.field]),b.expandColumn==g)for(e?k.prepend('<span class="treetable-expander '+j+'"></span>'):k.prepend('<span class="treetable-expander"></span>'),m=0;f-1>m;m++)k.prepend('<span class="treetable-indent"></span>');i.append(k)}}),i},k=function(c){var d,e,f=n.find("tbody");return n.find("thead"),f.html(""),!c||c.length<=0?(d='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">没有找到匹配的记录</div></td></tr>',f.html(d),void 0):(g(c),e=h(),e&&a.each(e,function(a,b){var c="row_id_"+a;i(b,1,c,"row_root",f)}),a.each(c,function(a,b){if(!b.isShow){var c=j(b,!1,1,"","");f.append(c)}}),n.append(f),m(),l(),void 0)},l=function(){n.find("tbody").find("tr").unbind(),n.find("tbody").find("tr").click(function(){if(d){var b=a(this).find("input[name='select_item']");"radio"==b.attr("type")?(b.prop("checked",!0),n.find("tbody").find("tr").removeClass("treetable-selected"),a(this).addClass("treetable-selected")):b.prop("checked")?(b.prop("checked",!1),a(this).removeClass("treetable-selected")):(b.prop("checked",!0),a(this).addClass("treetable-selected"))}})},m=function(){n.find("tbody").find("tr").find(".treetable-expander").unbind(),n.find("tbody").find("tr").find(".treetable-expander").click(function(){var c,d,e,f=a(this).hasClass(b.expanderExpandedClass),g=a(this).hasClass(b.expanderCollapsedClass);(f||g)&&(c=a(this).parent().parent(),d=c.attr("id"),e=n.find("tbody").find("tr[id^='"+d+"_']"),f?(a(this).removeClass(b.expanderExpandedClass),a(this).addClass(b.expanderCollapsedClass),e&&e.length>0&&a.each(e,function(b,c){a(c).css("display","none")})):(a(this).removeClass(b.expanderCollapsedClass),a(this).addClass(b.expanderExpandedClass),e&&e.length>0&&a.each(e,function(c,d){var e=a("#"+a(d).attr("pid")).children().eq(b.expandColumn).find(".treetable-expander");e.hasClass(b.expanderExpandedClass)&&a(d).css("display","table")})))})},n.load=function(c){var e,f,g,h;n.data_list={},n.data_obj={},n.html(""),e=a("<tr></tr>"),a.each(b.columns,function(b,c){if("undefined"==typeof c.visible||1==c.visible){var f=null;0==b&&"selectItem"==c.field?(d=!0,f=a('<th style="width:36px"></th>')):f=a('<th style="'+(c.width?"width:"+c.width:"")+'"></th>'),f.text(c.title),e.append(f)}}),f=a('<thead class="treetable-thead"></thead>'),f.append(e),n.append(f),g=a('<tbody class="treetable-tbody"></tbody>'),n.append(g),h='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">正在努力地加载数据中，请稍候……</div></td></tr>',g.html(h),b.height&&g.css("height",b.height),b.url?a.ajax({type:b.type,url:b.url,data:c?c:b.ajaxParams,dataType:"JSON",success:function(a){k(a)},error:function(a){var c='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">'+a.responseText+"</div></td></tr>";g.html(c)}}):k(b.data)},n.appendData=function(c){a.each(c,function(c,d){var e,f,h,i,k,l,m,o,p=n.data_obj["id_"+d[b.id]],q=n.data_obj["id_"+d[b.parentId]],r=n.data_list["_n_"+d[b.parentId]],s="",t="",u=1;p&&p.row_id&&""!=p.row_id&&(s=p.row_id),q?(t=q.row_id,""==s&&(f=0,r&&r.length>0&&(f=r.length),s=q.row_id+"_"+f),u=q.lv+1,e=j(d,!1,u,s,t),h=a("#"+q.row_id).children().eq(b.expandColumn).find(".treetable-expander"),i=h.hasClass(b.expanderExpandedClass),k=h.hasClass(b.expanderCollapsedClass),i||k?i&&e.css("display","table"):h.addClass(b.expanderCollapsedClass),p?(a("#"+p.row_id).before(e),a("#"+p.row_id).remove()):(l=q.row_id.split("_"),m=q.row_id.substring(0,q.row_id.length-1)+(parseInt(l[l.length-1])+1),a("#"+m).before(e))):(e=j(d,!1,u,s,t),p?(a("#"+p.row_id).before(e),a("#"+p.row_id).remove()):(o=n.find("tbody"),o.append(e))),d.isShow=!0,g([d])}),m(),l()},n.load(),n.data("bootstrap.tree.table",n),n)},a.fn.bootstrapTreeTable.methods={getSelections:function(b){var c,d=b.find("tbody").find("tr").find("input[name='select_item']:checked"),e=[];return"radio"==d.attr("type")?(c=b.data_obj["id_"+d.val()],e.push(c)):d.each(function(c,d){var f=b.data_obj["id_"+a(d).val()];e.push(f)}),e},refresh:function(a,b){b?a.load(b):a.load()},appendData:function(a,b){b&&a.appendData(b)}},a.fn.bootstrapTreeTable.defaults={id:"id",parentId:"parentId",rootIdValue:null,data:null,type:"GET",url:null,ajaxParams:{},expandColumn:0,expandAll:!1,expandFirst:!0,striped:!1,bordered:!0,columns:[],toolbar:null,height:0,expanderExpandedClass:"glyphicon glyphicon-chevron-down",expanderCollapsedClass:"glyphicon glyphicon-chevron-right"}}(jQuery);