!function(a){a.fn.bootstrapTreeTable=function(b,c){var d,e,f,g,h,i,j,k,l=a(this).data("bootstrap.tree.table");return l=l?l:a(this),"string"==typeof b?a.fn.bootstrapTreeTable.methods[b](l,c):(b=a.extend({},a.fn.bootstrapTreeTable.defaults,b||{}),d=!1,l.data_list=null,l.data_obj=null,e=a("<div class='bootstrap-tree-table'></div>"),l.before(e),e.append(l),l.addClass("table table-hover treetable-table"),b.striped&&l.addClass("table-striped"),b.bordered&&l.addClass("table-bordered"),b.toolbar&&(f=a("<div class='treetable-bars pull-left'></div>"),f.append(a(b.toolbar)),e.before(f)),g=function(c){var d=b.rootCodeValue?b.rootCodeValue:null;a.each(c,function(a,c){c.isShow=!1;var e="0"==c[b.parentCode]||0==c[b.parentCode]||null==c[b.parentCode]||""==c[b.parentCode];!c[b.parentCode]||(d?c[b.parentCode]==b.rootCodeValue:e)?(l.data_list._root_||(l.data_list._root_=[]),l.data_list._root_.push(c)):(l.data_list["_n_"+c[b.parentCode]]||(l.data_list["_n_"+c[b.parentCode]]=[]),l.data_list["_n_"+c[b.parentCode]].push(c)),l.data_obj["id_"+c[b.id]]=c,l.data_obj["code_"+c[b.code]]=l.data_obj["id_"+c[b.id]]}),c=null},h=function(){return l.data_list._root_},i=function(c,d,e,f,g){var h=l.data_list["_n_"+c[b.code]],k=j(c,h?!0:!1,d,e,f);g.append(k),h&&a.each(h,function(a,b){var c=e+"_"+a;i(b,d+1,c,e,g)})},j=function(c,e,f,g,h){var i,j;return c.isShow=!0,i=a('<tr id="'+g+'" pid="'+h+'"></tr>'),j=b.expanderCollapsedClass,b.expandAll?(i.css("display","table"),j=b.expanderExpandedClass):1==f?(i.css("display","table"),j=b.expandFirst?b.expanderExpandedClass:b.expanderCollapsedClass):2==f?(b.expandFirst?i.css("display","table"):i.css("display","none"),j=b.expanderCollapsedClass):(i.css("display","none"),j=b.expanderCollapsedClass),a.each(b.columns,function(g,h){var k,l,m;if("selectItem"==h.field)d=!0,k=a('<td style="text-align:center;width:36px"></td>'),h.radio&&(l=a('<input name="select_item" type="radio" value="'+c[b.id]+'"></input>'),k.append(l)),h.checkbox&&(l=a('<input name="select_item" type="checkbox" value="'+c[b.id]+'"></input>'),k.append(l)),i.append(k);else{if(k=a('<td title="'+c[h.field]+'" name="'+h.field+'" style="'+(h.width?"width:"+h.width:"")+'"></td>'),h.formatter?k.html(h.formatter.call(this,c[h.field],c,g)):k.text(c[h.field]),b.expandColumn==g)for(e?k.prepend('<span class="treetable-expander '+j+'"></span>'):k.prepend('<span class="treetable-expander"></span>'),m=0;f-1>m;m++)k.prepend('<span class="treetable-indent"></span>');i.append(k)}}),i},k=function(c){var e,f,k=l.find("tbody"),m=l.find("thead");return k.html(""),!c||c.length<=0?(e='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">没有找到匹配的记录</div></td></tr>',k.html(e),void 0):(g(c),f=h(),f&&a.each(f,function(a,b){var c="row_id_"+a;i(b,1,c,"row_root",k)}),a.each(c,function(a,b){if(!b.isShow){var c=j(b,!1,1);k.append(c)}}),l.append(k),m.css("width",k.children(":first").css("width")),l.find("tbody").find("tr").click(function(){if(d){var b=a(this).find("input[name='select_item']");"radio"==b.attr("type")?(b.prop("checked",!0),l.find("tbody").find("tr").removeClass("treetable-selected"),a(this).addClass("treetable-selected")):b.prop("checked")?(b.prop("checked",!1),a(this).removeClass("treetable-selected")):(b.prop("checked",!0),a(this).addClass("treetable-selected"))}}),l.find("tbody").find("tr").find(".treetable-expander").click(function(){var c,d,e,f=a(this).hasClass(b.expanderExpandedClass),g=a(this).hasClass(b.expanderCollapsedClass);(f||g)&&(c=a(this).parent().parent(),d=c.attr("id"),f?(a(this).removeClass(b.expanderExpandedClass),a(this).addClass(b.expanderCollapsedClass),e=l.find("tbody").find("tr[id^='"+d+"_']"),e&&e.length>0&&a.each(e,function(b,c){a(c).css("display","none")})):(a(this).removeClass(b.expanderCollapsedClass),a(this).addClass(b.expanderExpandedClass),e=l.find("tbody").find("tr[id^='"+d+"_']"),e&&e.length>0&&a.each(e,function(c,d){var e=a("#"+a(d).attr("pid")).children().eq(b.expandColumn).find(".treetable-expander");e.hasClass(b.expanderExpandedClass)&&a(d).css("display","table")})))}),void 0)},l.load=function(c){var e,f,g,h;l.data_list={},l.data_obj={},l.html(""),e=a("<tr></tr>"),a.each(b.columns,function(b,c){var f=null;0==b&&"selectItem"==c.field?(d=!0,f=a('<th style="width:36px"></th>')):f=a('<th style="'+(c.width?"width:"+c.width:"")+'"></th>'),f.text(c.title),e.append(f)}),f=a('<thead class="treetable-thead"></thead>'),f.append(e),l.append(f),g=a('<tbody class="treetable-tbody"></tbody>'),l.append(g),h='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">正在努力地加载数据中，请稍候……</div></td></tr>',g.html(h),b.height&&g.css("height",b.height),b.url?a.ajax({type:b.type,url:b.url,data:c?c:b.ajaxParams,dataType:"JSON",success:function(a){k(a)},error:function(a){var c='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">'+a.responseText+"</div></td></tr>";g.html(c)}}):k(b.data)},l.appendData=function(a){k(a)},l.load(),l.data("bootstrap.tree.table",l),l)},a.fn.bootstrapTreeTable.methods={getSelections:function(b){var c,d=b.find("tbody").find("tr").find("input[name='select_item']:checked"),e=[];return"radio"==d.attr("type")?(c=b.data_obj["id_"+d.val()],e.push(c)):d.each(function(c,d){var f=b.data_obj["id_"+a(d).val()];e.push(f)}),e},refresh:function(a,b){b?a.load(b):a.load()},appendData:function(a,b){b&&a.appendData(b)}},a.fn.bootstrapTreeTable.defaults={id:"id",code:"id",parentCode:"parentId",rootCodeValue:null,data:null,type:"GET",url:null,ajaxParams:{},expandColumn:0,expandAll:!1,expandFirst:!0,striped:!1,bordered:!0,columns:[],toolbar:null,height:0,expanderExpandedClass:"glyphicon glyphicon-chevron-down",expanderCollapsedClass:"glyphicon glyphicon-chevron-right"}}(jQuery);